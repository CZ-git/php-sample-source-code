(function(e,t){window.touchSlider=function(i){function n(e){x.removeClass(i.currentClass).eq(e).addClass(i.currentClass)}function a(e,i){var n=p.current;n!==e&&(e=e!==t?e:n+1,T.to(e,{complete:i}))}function r(e){T.to(p.current+1,{dirX:1,complete:e})}function o(e){T.to(p.current-1,{dirX:-1,complete:e})}function s(){D&&l()}function l(){return D=!0,$||(clearTimeout(S),S=setTimeout(function(){T.moving||$||r()},i.delay)),i.container}function c(){return clearTimeout(S),D=!1,i.container}function d(){var i,n,a,r,o,s,l,c,d,h,p,w,x,_=e(document),C=!1,S=function(e){if(!(e.which>1)){if(C&&_.triggerHandler(v+"."+u),C=!0,n=!1,i=e.timeStamp,l=w=0,a=[0,0,0,i],e.originalEvent.touches)return _.one(m,$),t;e.preventDefault(),o=s=e.pageX,h=p=e.pageY,d=b[0].offsetLeft,r=[0,0,0,o],_.bind(g,D),_.one(v+"."+u,E),T.moveStart(e)}},$=function(e){1===e.originalEvent.touches.length&&(o=s=e.pageX=e.originalEvent.touches[0].pageX,h=p=e.pageY=e.originalEvent.touches[0].pageY,c=x=0,d=new WebKitCSSMatrix(window.getComputedStyle(b[0]).webkitTransform).e,r=[0,0,0,o],_.bind(g,D),_.one(v,E),T.moveStart(e))},D=function(e){var t,i;if(e.originalEvent.touches&&f){if(1!==e.originalEvent.touches.length)return;if(t=e.pageX=e.originalEvent.touches[0].pageX,i=e.pageY=e.originalEvent.touches[0].pageY,c+=Math.abs(t-s),x+=Math.abs(i-p),Math.abs(c-x)>50){var o=c;c=Math.min(100,Math.max(0,c-x)),x=Math.min(100,Math.max(0,x-o))}if(t===s)return;n||(c>x?(e.preventDefault(),n=!0):E(e))}else{if(t=e.pageX,i=e.pageY,t===s)return;/msie/.test(navigator.userAgent.toLowerCase())&&e.preventDefault()}l+=Math.abs(t-s),w+=Math.abs(i-p),a.shift(),a.push(e.timeStamp),r.shift(),r.push(t),T.move(e,s),s=t,p=i},E=function(e){C=!1,(!e.originalEvent||e.originalEvent.touches)&&(e.pageX=s,e.pageY=p),_.unbind(g,D);for(var t=a.length,n=0,o=0;--t>0;)if(a[t-1]){var c=r[t]-r[t-1];n+=Math.abs(c)/(a[t]-a[t-1]),0!==c&&(o=c>0?-1:1)}n/=a.length,T.moveEnd(e,n,o,i,l,w),k=!1,l+w>4&&y.one("click",function(e){e.preventDefault()})};y.bind(m,S)}i=i||{};var u=i.namespace||"touchslider",h=e(i.container);if(1!==h.length)return h.each(function(){touchSlider({container:this})}),t;i=e.extend({autoplay:!1,delay:3e3,margin:5,viewport:"."+u+"-viewport",prev:"."+u+"-prev",next:"."+u+"-next",pagination:"."+u+"-nav-item",currentClass:u+"-nav-item-current",duration:350,mouseTouch:!0},i);var p={current:0,step:a,next:r,prev:o,start:l,stop:c},f="ontouchstart"in window&&"WebKitCSSMatrix"in window,m="touchstart",g="touchmove",v="touchend",y=e(i.viewport,h),b=i.scroller?e(i.scroller,h):y.children(),w=b.children(),x=e(i.pagination,h);if("absolute"!==b.css("position")){var _=y.height();y.css({height:_,position:"relative"}),b.css({position:"absolute",left:0,height:_,width:1e5})}f||(m="mousedown",g="mousemove",v="mouseup"),w.css("position","absolute");var C=f?function(e,i,n){return i===t?new WebKitCSSMatrix(getComputedStyle(e.jquery?e[0]:e).webkitTransform).e:(e.css({webkitTransitionDuration:n?n+"ms":"0",webkitTransform:function(e){return"translate3d("+("number"==typeof i?i:i.call(this,e))+"px,0,0)"}}),t)}:function(e,i){return i===t?parseInt((e.jquery?e[0]:e).style.left,10):(e.css("left",i),t)};f&&w.css({webkitTransitionProperty:"-webkit-transform",webkitTransitionTimingFunction:"cubic-bezier(0,0,0.25,1)"}),C(w.not(w[0]),1e4),C(w.eq(0),0);var T=function(){var a=[0],r=[0],o=e.noop;return{moving:!1,init:function(){b.bind("webkitTransitionEnd",function(){o()})},to:function(l,c){c=c||{},l>=w.length?l=0:0>l&&(l=w.length-1);var d=i.duration,u=w.eq(l),h=e.inArray(l,a),m=0;if(b.stop(),T.moving=!0,clearTimeout(S),-1!==h)m=r[h];else{var g,v=w.index(u);if(h=t,-1===c.dirX)r.unshift(0),a.unshift(v);else if(1===c.dirX)r.push(0),a.push(v);else{for(g=a.length-1;g>=0;g--)if(v>a[g]){r.splice(g+1,0,0),a.splice(g+1,0,v),h=0;break}h===t&&(r.unshift(r),a.unshift(v))}if(h=e.inArray(v,a),0===h)m=r[1]-(u.outerWidth()+i.margin),C(u,m),r[h]=m;else if(h===a.length-1)m=r[h-1]+w.eq(a[h-1]).outerWidth()+i.margin,C(u,m),r[h]=m;else{var y=u.outerWidth();u.css("opacity",0),m=r[h+1]-Math.round((y+i.margin)/2),r[h]=m,C(u,m);var x=m,_=a.length;for(g=h-1;g>=0;g--)x-=w.eq(a[g]).outerWidth()+i.margin,r[g]=x;var k=m;for(g=h+1;_>g;g++)k+=w.eq(a[g]).outerWidth()+i.margin,r[g]=k;for(g=0;_>g;g++)w.eq(a[g]).animate({left:r[g]},{duration:d,queue:!1,complete:function(){u.is(this)&&u.animate({opacity:1},d)}})}}c.pxInMs&&(d=Math.min(Math.max(Math.round(Math.abs(C(b))/c.pxInMs),100),d)),o=function(){C(w.not(u),-1e4),a=[w.index(u)],r=[m],c.complete&&c.complete(),T.moving=!1,s()},f?C(b,-m,d):b.animate({left:-m},{duration:d,queue:!1,complete:o}),p.current=l,n(l)},stop:function(){f?C(b,C(b)):b.stop()},moveStart:function(e){T.moving=!0,clearTimeout(S),b.stop(),T.startPageX=e.pageX;var t,i=C(b);T.leftCount=i,0===a[0]?r[0]+i>0&&(T.leftCount=i+3*(r[0]+i)):a[a.length-1]===w.length-1&&(t=r[a.length-1]+i,0>t&&(T.leftCount=i+3*t))},move:function(e,t){var n,o,s,l=e.pageX-t,c=C(b),d=w.eq(a[0]),u=a.length-1,h=w.eq(a[u]);if(T.leftCount+=l,l>0)for(;0!==a[0]&&c+r[0]+l>i.margin;)n=w.eq(a[0]-1),o=r[0]-n.outerWidth()-i.margin,C(n,o),r.unshift(o),a.unshift(a[0]-1),u++,d=n;if((l>0&&c+r[0]+l>0||0>l&&c+r[0]>0)&&0===a[0]&&(s=Math.min(Math.round((T.leftCount+r[0])/4),y.innerWidth()/2),l=s-(c+r[0])),0>l)for(;!h.is(w.last())&&c+r[u]+l+h.outerWidth()+i.margin<y.innerWidth();)n=w.eq(a[u]+1),o=r[u]+h.outerWidth()+i.margin,C(n,o),r.push(o),a.push(a[u++]+1),h=n;(l>0&&0>c+r[u]||0>l&&0>c+r[u]+l)&&h.is(w.last())&&(s=Math.max(Math.round((T.leftCount+r[u])/4),-y.innerWidth()/2),l=s-(c+r[u])),C(b,c+l)},moveEnd:function(e,t,i,n,o,s){var l,c=a.length,d=C(b),u=c-1;if(r[0]+d>0)u=0;else if(0>r[a.length-1]+d);else{l={pxInMs:t};var h,p,f=c-1,m=y.innerWidth();for(h=0;c-1>h;h++)if(p=r[h]+w.eq(a[h]).outerWidth()+d,p>0&&p>m-(r[h+1]+d)){f=h;break}if(k)u=f;else{var g=c-1,v=Math.round(b.offset().left);for(h=0;c>h;h++)if(r[h]+v>e.pageX){g=h-1;break}u=f,f===g&&1e3>e.timeStamp-n&&o+s>.05*Math.sqrt(Math.pow(y.height(),2)+Math.pow(m,2))&&(u=Math.max(0,Math.min(c-1,u+i)))}}u=a[u],T.to(u,l)}}}();if(T.init(),f){var k=!1;b.bind("webkitTransitionStart",function(){k=!0}),b.bind("webkitTransitionEnd",function(){k=!1})}var S,$=!1,D=!1;y.hover(function(){clearTimeout(S),$=!0},function(){$=!1,s()}),x.click(function(){a(x.index(this))}),e(i.prev,h).click(function(){o()}),e(i.next,h).click(function(){r()}),i.mouseTouch&&d(),i.autoplay&&l(),h.data(u,p)},e.fn.touchSlider=function(e){return e=e||{},e.container=this,touchSlider(e),this}})(jQuery);